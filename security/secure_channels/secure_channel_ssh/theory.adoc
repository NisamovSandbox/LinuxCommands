=== Protocolo SSH

SSH (*Secure Shell*) es un protocolo que permite la interacción segura entre máquinas a través de una línea de comandos. +
Funciona tanto en sistemas *Linux* como *Windows* y utiliza cifrado para proteger la comunicación.

*Datos técnicos:*
- *Protocolo:* SSH
- *Puerto por defecto:* **22/TCP**
- *Servicio:* **sshd** (daemon que escucha peticiones en el puerto 22)
- *Flujo:* IP → Red → Puerto

Para conectarse por SSH es necesario conocer:
- Usuario
- Contraseña (o clave privada)

==== SSH: Acceso, Claves y Seguridad

*Generación de clave SSH:*
Creación de clave pública y privada con nombre (id_rsa)

[source,sh]
----
[user@host ~]$ ssh-keygen
----

*Configuración de cuenta remota para acceso:*

[source,sh]
----
[user@host ~]$ ssh-copy-id -i .ssh/key-with-pass.pub user@remotehost
----

El comando `ssh-copy-id` nos permite enviar la clave pública a la máquina destino.

El comando `-i` permite comprobar el acceso, así mismo el comando `-v` (verbose) permite ver el proceso completo para poder revisar cada uno de los pasos.

La estructura del comando es la siguiente:

[source,sh]
----
[user@host ~]$ ssh <valor> <clave(ruta rel o absoluta)> <maquina destino> <comando>
----

*Ejemplo práctico:*

[source,sh]
----
[user@host ~]$ ssh -i .ssh/key2 operator1@servera hostname
----

*Rutas y archivos por defecto:*
Por defecto al crear una clave con `ssh-keygen`, se crea en la ruta: `/home/usuario/.ssh/*`

Contenido generado:
- `id_rsa.pub` (Clave pública [cliente y servidor])
- `id_rsa` (Clave privada [Clave privada de nuestro equipo para la autenticación con el servidor y cliente])

[WARNING]
====
*¡Precaución con la sobreescritura de claves!*
Si generamos dos claves sin establecer un nombre, se sobreescribirán, por ende, si se han distribuido las claves, no será posible acceder.

*Ejemplo de lo que NO se debe hacer:*

[source,sh]
----
[user@host ~]$ ssh-keygen # Primera generación
[user@host ~]$ ssh -i .ssh/key2 operator1@servera hostname # Se comparte la clave
[user@host ~]$ ssh-keygen # Segunda generación (sobreescribe a la primera)
----

Esto provocará que la primera clave sea reemplazada, haciendo que el acceso anterior deje de funcionar.
====

*Recomendación:*
Para generar claves con nombres personalizados y evitar conflictos:

[source,sh]
----
ssh-keygen -f ~/.ssh/nombre_clave
----

Esto generará:
- `~/.ssh/nombre_clave` (clave privada)
- `~/.ssh/nombre_clave.pub` (clave pública)

